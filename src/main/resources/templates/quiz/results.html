<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Results</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .score-display {
            font-size: 3rem;
            font-weight: bold;
        }
        .score-excellent { color: #28a745; }
        .score-good { color: #ffc107; }
        .score-poor { color: #dc3545; }
        .correct-answer { background-color: #d4edda; border-left: 4px solid #28a745; }
        .wrong-answer { background-color: #f8d7da; border-left: 4px solid #dc3545; }
        .not-answered { background-color: #f8f9fa; border-left: 4px solid #6c757d; }
    </style>
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/">QuizApp</a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" th:href="@{/dashboard}">Back to Dashboard</a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <h1>Quiz Results</h1>

    <!-- Messages -->
    <div th:if="${success}" class="alert alert-success">
        <span th:text="${success}"></span>
    </div>
    <div th:if="${error}" class="alert alert-danger">
        <span th:text="${error}"></span>
    </div>

    <div class="card mb-4">
        <div class="card-body text-center">
            <h3 th:text="${quiz.title}">Quiz Title</h3>

            <div th:if="${score != null}">
                <div th:classappend="${score >= 70} ? 'score-display score-excellent' : (${score >= 50} ? 'score-display score-good' : 'score-display score-poor')">
                    <span th:text="${#numbers.formatDecimal(score, 1, 2)}">0.0</span>%
                </div>

                <p class="lead" th:if="${totalQuestions != null}">
                    You answered
                    <strong th:text="${#numbers.formatInteger((score / 100) * totalQuestions, 1)}">0</strong>
                    out of <strong th:text="${totalQuestions}">0</strong> questions correctly
                </p>

                <p th:if="${score >= 70}" class="text-success h5">üéâ Excellent! Well done!</p>
                <p th:if="${score >= 50 and score < 70}" class="text-warning h5">üëç Good job! Keep it up!</p>
                <p th:if="${score < 50}" class="text-danger h5">üí™ Keep practicing! You'll do better next time!</p>
            </div>

            <div th:if="${score == null}" class="text-warning">
                <p class="lead">Score calculation in progress...</p>
            </div>

            <div class="mt-4">
                <p><strong>Completed on:</strong>
                    <span th:text="${#temporals.format(attempt.completedAt, 'dd/MM/yyyy HH:mm')}">Date</span>
                </p>
            </div>
        </div>
    </div>

    <!-- Detailed Results -->
    <div class="card">
        <div class="card-header bg-info text-white">
            <h5 class="card-title mb-0">Detailed Results</h5>
        </div>
        <div class="card-body">
            <div th:each="question, iter : ${quiz.questions}">
                <!-- Get user answer for this question -->
                <div th:with="userAnswer=${attempt.answers[question.id]}">
                    <div th:classappend="${userAnswer != null and userAnswer == question.correctAnswerIndex} ? 'correct-answer' : (${userAnswer != null} ? 'wrong-answer' : 'not-answered')"
                         class="card mb-3 p-3">
                        <h6>Question <span th:text="${iter.index + 1}">1</span></h6>
                        <p th:text="${question.questionText}">Question text</p>

                        <div class="options">
                            <div th:each="option, optIter : ${question.options}">
                                <div th:if="${optIter.index == question.correctAnswerIndex}" class="text-success fw-bold">
                                    ‚úÖ <span th:text="${option}"></span>
                                    <span class="badge bg-success ms-2">Correct Answer</span>
                                </div>
                                <div th:if="${optIter.index != question.correctAnswerIndex and userAnswer == optIter.index}" class="text-danger fw-bold">
                                    ‚ùå <span th:text="${option}"></span>
                                    <span class="badge bg-danger ms-2">Your Answer</span>
                                </div>
                                <div th:if="${optIter.index != question.correctAnswerIndex and userAnswer != optIter.index}" class="text-muted">
                                    <span th:text="${option}"></span>
                                </div>
                            </div>
                        </div>

                        <div class="mt-2">
                            <small class="text-muted">
                                <strong>Status:</strong>
                                <span th:if="${userAnswer != null and userAnswer == question.correctAnswerIndex}" class="text-success">‚úÖ Correct</span>
                                <span th:if="${userAnswer != null and userAnswer != question.correctAnswerIndex}" class="text-danger">‚ùå Incorrect</span>
                                <span th:if="${userAnswer == null}" class="text-warning">‚è∏Ô∏è Not Answered</span>
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="text-center mt-4">
        <a th:href="@{/dashboard}" class="btn btn-primary btn-lg me-3">Back to Dashboard</a>
        <a th:href="@{/quiz/list}" class="btn btn-outline-primary btn-lg">Take Another Quiz</a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>